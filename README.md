## 引言

很多情侣在确立了恋爱关系后，为了推进感情的发展，都会前往向往已久的名山大川旅行。情侣们到了景区之后会买同心锁，挂在一起游览过的地方，以此来象征爱情的永恒长久。同心锁不仅丰富了旅行，而且一定程度上促进了旅游业的发展。但是对于景区，每年都会接待数以万计的游客，可以用于挂锁的空间越来越少，而且也出现了随处乱挂的行为，因此部分景区对可挂锁的景点进行了限制。此外，出于安全管理以及景区的可持续发展等方面的考虑，景区会回收部分同心锁，以减少其重量对于旅游设施安全性的威胁。但是，此举确保安全的同时，也难免略显不妥，毕竟情侣分手后可能还会不远万里回到景区，只为寻找当年那把同心锁。

## 核心功能

为了解决上述问题，同时进一步升华同心锁的发明意义，本文提出了一种基于区块链技术的同心锁数字化替代方案——永恒之恋•山海珈锁。区块链具有天然的可信性和不可篡改性，在国内的应用以联盟链居多。通过区块链账本的分布式存储，可以确保链上数据的可追溯性和不可篡改性。

当情侣游历景点时，可以通过手机APP扫码的方式，将对彼此的山盟海誓以及当时的合照上传至APP，同时输入一个未来可能的结婚期限date，而APP会记录当前的上传时间Date。而后双方可以各自输入具有祝福意义的金额，但对于初次使用APP的用户并不用立即支付，只是一种数字约定。在date之前，若双方结婚，则可以凭借结婚信息（例如结婚证的截图）获得计算公式为（D[(当前时间 - Date)] / D[(date - Date)] * 链上总金额 * 0.01)的资金奖励。（结婚越早，奖励越多，D[]为按天数取整）。若用户超过date未提供结婚信息，或者双方中某一位违背了曾经的山盟海誓导致其中一方选择提前开锁，则双方均需要支付当初输入计算公式为（D[(date - Date)] / D[(当前时间 - Date)] * 双方输入金额总和）的金额，当然也可以不支付，这样会被永恒之恋•山海珈锁系统永久拉黑，当然也可能导致多个景点的APP同时对用户进行拉黑处理。因此用户使用APP时需要进行身份认证。

对于在该景点的山海珈锁上已经有支付信息的用户而言，山海珈锁希望用户能够珍视感情，把握机会，因此当该用户再次使用时，会直接进行收费处理，例如输入金额时，会要求立即支付金额的50%，若在date前完成结婚信息的上传，则会返回已经支付的金额以及奖励。若依然未能如愿，则双方支付的金额按照扣除50%后的总金额计算。当date到达时，双方也可以选择延期，即重新设定date值，但双方均需要立即支付计算公式为([(新date - Date) / (旧date - Date)] * 0.01 * 双方输入金额总和)的金额(新date越久远，支付越多) ，待提供结婚信息后，同样会一起返还。已经开启山海珈锁，即被锁定的两个用户中，任一一人在当前锁被解开之前，无法再次与另一个用户共同开启山海珈锁，从而一定程度上避免出轨与出墙。所有支付的金额均通过智能合约记录于链上，用于维持整个永恒之恋•山海珈锁分布式生态。

智能合约主要实现用户地址记录、金额记录、发放奖励等功能。系统后端实现计算时间、触发交易执行以及认证等功能。发放的奖励可以用于兑换对应景区的包含爱情哈希值的专属纪念品，如刻有爱情哈希值的戒指（爱情哈希值由智能合约基于防碰撞哈希函数生成，可理解为世间唯一），进而促进情侣重游景点。有关于时间计算的操作应该放到后端进行，但出于合约完整性，在合约中进行不完全实现，以自2023年开始的总天数统计各类参与计算的时间。在具体实现过程中涉及许多同步与互斥操作，例如已经被锁定的用户不能再次被同一把锁锁住（互斥），以及双方需要同步进行的操作，均以男生先操作，女生后操作的顺序执行（同步）。互斥与同步关系均可通过信号量实现。

## 意义

永恒之恋•山海珈锁方案致力于以区块链技术一定程度上助力旅游景点可持续发展，促进情侣恋爱关系的发展，构建友好生态。在以数字化方案替代实体同心锁的同时，节约了资源，利于环保，解决了实体锁乱挂现象所导致的安全隐患。为情感顺利的情侣增添幸福感，促进情感不顺的情侣及时做出自己的选择。
## 参考文献

[小情侣在景区里挂的同心锁，最后都去哪里了？真相令人咋舌|爱情|挂锁_网易订阅 (163.com)](https://www.163.com/dy/article/G560DLMI0531B6OI.html)

[yekai1003/marriage-demo: 基于fisco bcos 区块链的结婚证书系统 (github.com)](https://github.com/yekai1003/marriage-demo)
